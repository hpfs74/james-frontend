<div class="container-fluid knx-container--fullwidth knx-container--gray">
  <div class="container">
    <ol *ngIf="formSteps" class="knx-step-navigation">
      <li *ngFor="let step of formSteps; let i = index;" class="knx-step-navigation__step" [ngClass]="{ 'knx-step-navigation__step--current': i === currentStep }">{{ step.label }}</li>
    </ol>
  </div>
</div>

<div class="container car-forms__container">
  <knx-wizard (stepChange)="onStepChange($event)">
    <div class="knx-wizard__steps">
      <knx-step [options]="formSteps[0]">

        <knx-car-detail-form (licensePlateChange)="getCarInfo($event)" (addressChange)="updateAddress($event)" (coverageDetailsChange)="getCoverages($event)"
          (coverageSelected)="updateSelectedCoverage($event)" (formControlFocus)="showHelperText($event)" [form]="carDetailForm"
          [coverages]="coverages" [submitted]="carDetailSubmitted && currentStep === 0" [isCoverageLoading]="isCoverageLoading">
        </knx-car-detail-form>
      </knx-step>

      <knx-step [options]="formSteps[1]">
        <knx-insurance-toplist (insuranceSelected$)="onSelectPremium($event)" [stepAmount]="4" [insurances]="insurances | async">
        </knx-insurance-toplist>
      </knx-step>
    </div>

    <div class="knx-wizard__sidebar" #knxWizardSidebar>
      <knx-chat-stream [options]="chatConfig" [messages]="chatMessages" [formGroup]="carExtrasForm.formGroup">
        <knx-car-extras
          [form]="carExtrasForm"
          [show]="currentStep === 1"
          optionModifierClass="hidden-xs">
        </knx-car-extras>

        <!-- alternative view with sidenav for mobile devices -->
        <ng-container *ngIf="currentStep === 1" [formGroup]="carExtrasForm.formGroup">
          <knx-side-panel #knxSidePanel title="Wijzig">
            <div class="container-fluid">
              <div class="knx-side-panel-content">
                <knx-car-extras
                  [form]="carExtrasForm"
                  [show]="currentStep === 1">
                </knx-car-extras>

                <button class="knx-button knx-button--secondary knx-button--fullwidth knx-button--arrow" (click)="knxSidePanel.close()">Verder</button>
              </div>
            </div>
          </knx-side-panel>

          <button class="car-forms__edit hidden-md-up knx-button knx-button--pill" (click)="knxSidePanel.open()">Extra opties selecteren</button>
        </ng-container>
        <!-- end mobile view -->

      </knx-chat-stream>
    </div>

  </knx-wizard>
</div>
