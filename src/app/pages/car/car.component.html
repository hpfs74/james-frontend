<div class="container-fluid knx-container--fullwidth knx-container--gray">
  <div class="container">
    <ol *ngIf="formSteps" class="knx-step-navigation">
      <li *ngFor="let step of formSteps; let i = index;"
        class="knx-step-navigation__step"
        [ngClass]="{ 'knx-step-navigation__step--current': getCurrentStepIndex(i) }">{{ step.title }}</li>
    </ol>
  </div>
</div>

<!-- TODO: remove me when refresh implemented -->
<div #el style="position:absolute;top:50px;right:20px;width:300px;background: yellow;border:1px solid red;padding:10px">
  <small>Current Token: <br><textarea style="width:100%">{{token}}</textarea></small><br>
  <a style="margin-right:10px" (click)="refreshToken()">refresh</a>
  <a (click)="el.style.display = 'none'">hide</a>
</div>

<div class="container">

  <div class="row">
    <div class="col-md-8">
      <div class="car-forms__container">

        <div class="car-form" [ngSwitch]="currentFormStep.id">
          <knx-car-detail-form
            *ngSwitchCase="'carDetails'"
            (licensePlateChange)="getCarInfo($event)"
            (addressChange)="updateAddress($event)"
            (coverageDetailsChange)="getCoverages($event)"
            (coverageSelected)="updateSelectedCoverage($event)"
            (formControlFocus)="showHelperText($event)"
            [coverages]="coverages"
            [isCoverageLoading]="isCoverageLoading"
            [submitted]="formSteps[0].submitted">
          </knx-car-detail-form>

          <knx-insurance-toplist
            *ngSwitchCase="'carResults'"
            (insuranceSelected$)="goToNextStep($event)"
            [stepAmount]="4"
            [insurances]="insurances | async">
          </knx-insurance-toplist>

        </div>

        <div class="cx-form-group cx-form-group--space-between">
          <button class="knx-button knx-button--link knx-button--back" (click)="goToPreviousStep()">Terug</button>
          <button class="knx-button knx-button--secondary knx-button--arrow" (click)="goToNextStep()">Volgende</button>
        </div>

      </div>
    </div>
    <div class="col-md-4">

      <knx-chat-stream [options]="chatConfig" [messages]="chatMessages" [formGroup]="carExtrasForm.formGroup">

        <knx-collapse-message title="Dekking" *ngIf="insurances" [isOpen]="true">
          <cx-form-group
            [formControlName]="carExtrasForm.formConfig.coverage.formControlName"
            [options]="carExtrasForm.formConfig.coverage">
          </cx-form-group>
        </knx-collapse-message>

        <knx-collapse-message title="Aanvullende dekkingen" *ngIf="insurances" [isOpen]="true">
          <cx-form-group
            [formControlName]="carExtrasForm.formConfig.extraOptions.formControlName"
            [options]="carExtrasForm.formConfig.extraOptions">
          </cx-form-group>
        </knx-collapse-message>

        <knx-collapse-message title="Aantal KM per jaar" *ngIf="insurances" [isOpen]="true">
          <cx-form-group
            [formControlName]="carExtrasForm.formConfig.kmPerYear.formControlName"
            [options]="carExtrasForm.formConfig.kmPerYear">
          </cx-form-group>
        </knx-collapse-message>

        <knx-collapse-message title="Eigen risico" *ngIf="insurances" [isOpen]="true">
          <cx-form-group
            class="own-risk"
            [formControlName]="carExtrasForm.formConfig.ownRisk.formControlName"
            [options]="carExtrasForm.formConfig.ownRisk">
          </cx-form-group>
        </knx-collapse-message>

      </knx-chat-stream>
    </div>
  </div>
</div>
