<form [formGroup]="form.formGroup" class="knx-fancy-form car-detail-form">
  <div class="row">
    <div class="col-sm-12">
      <knx-card>
        <h3>Je autogegevens</h3>

        <div class="row">
          <div class="col-md-7 col-sm-12">
            <knx-form-group [options]="form.formConfig.licensePlate">
              <knx-input-licenseplate
                knxQaIdentifier [qaRoot]="qaRootId" qaIdentifier="licensePlate"
                (ngModelChange)="onLicensePlateChange($event)"
                [formControlName]="form.formConfig.licensePlate.formControlName"
                [options]="form.formConfig.licensePlate.inputOptions">
              </knx-input-licenseplate>
            </knx-form-group>

            <knx-async-preview
            [loading]="isCarLoading$ | async"
            [loaded]="!(isCarFailed$ | async) && form.formGroup.get('licensePlate').value && !form.formGroup.get('licensePlate').hasError('licensePlate')"
            [hidden]="!(isCarLoading$ | async) && featureToggleService.isOn('carInfo')">
              <knx-car-info *ngIf="!featureToggleService.isOn('carInfo')" [data]="car$ | async"></knx-car-info>
            </knx-async-preview>

            <div class="knx-form-group__label knx-pull-up"
              *ngIf="featureToggleService.isOn('carInfo') && !(isCarFailed$ | async) && form.formGroup.get('licensePlate').value && !form.formGroup.get('licensePlate').hasError('licensePlate')">
              {{ (car$ | async)?.make | capitalize }} {{ (car$ | async)?.model | capitalize }} {{ (car$ | async)?.year | capitalize }}
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 col-sm-12">
            <div class="knx-form-group--info knx-form-group--info-input">
              <knx-form-group
                knxQaIdentifier [qaRoot]="qaRootId" qaIdentifier="claimFreeYears"
                [formControlName]="form.formConfig.claimFreeYears.formControlName"
                [options]="form.formConfig.claimFreeYears">

                <knx-tooltip>
                  <p>De <strong>schadevrije jaren</strong> vind je op je meest recente polis.
                  Je bouwt schadevrije jaren op als een auto op jouw naam is verzekerd. Schadevrije jaren geven je
                  korting op de premie.</p>

                  <p>Elk jaar dat je geen schade claimt, bouw je 1 schadevrij jaar op. Elke keer
                  dat je wel een schade claimt die jouw schuld is, verlies je 5 of meer jaren.</p>
                </knx-tooltip>
              </knx-form-group>
            </div>
          </div>
          <div class="col-md-4">
            <!--
            <div class="knx-form-group">
              <button class="knx-button knx-button--util inline-formelement">
                Help me bepalen
              </button>
            </div>
            -->
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 col-md-offset-6">
            <div class="knx-form-group--info knx-form-group--info-input">
              <knx-form-group
                knxQaIdentifier [qaRoot]="qaRootId" qaIdentifier="loan"
                [formControlName]="form.formConfig.loan.formControlName"
                [options]="form.formConfig.loan">

                <knx-tooltip>
                  We willen graag van je weten of je een lening hebt afgesloten voor je auto.
                  In dat geval raden we je namelijk altijd een Allrisk verzekering aan.
                  Raakt je auto vervolgens onherstelbaar beschadigd? Dan krijg je een vergoeding van je verzekeraar om een nieuwe te kopen.
                  Bij een andere dekking krijg je die vergoeding niet en blijf je met een lening achter, terwijl je geen auto meer hebt.
                </knx-tooltip>
              </knx-form-group>
            </div>
          </div>
        </div>
      </knx-card>

      <knx-card>
        <h3>Over jou <small>(als hoofdbestuurder)</small>
          <span class="knx-info-icon knx-icon-info-circle" style="cursor: pointer;">
            <knx-tooltip>
              Hoofdbestuurder is de persoon die in de meerderheid van de gevallen in de auto rijdt Ã©n eigenaar is van de auto.
              Als dit niet het geval is, kun je helaas geen autoverzekering afsluiten via Knab.
            </knx-tooltip>
          </span>
        </h3>

        <div class="row">
          <div class="col-md-4 col-sm-12">
            <knx-form-group
              knxQaIdentifier [qaRoot]="qaRootId" qaIdentifier="birthDate"
              [formControlName]="form.formConfig.birthDate.formControlName"
              [options]="form.formConfig.birthDate">
            </knx-form-group>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 col-md-offset-6">
            <knx-form-group
              knxQaIdentifier [qaRoot]="qaRootId" qaIdentifier="gender"
              [formControlName]="form.formConfig.gender.formControlName"
              [options]="form.formConfig.gender">
            </knx-form-group>
          </div>
        </div>

        <knx-address-lookup
          knxQaIdentifier [qaRoot]="qaRootId" qaIdentifier="address"
          [addressForm]="addressForm">
        </knx-address-lookup>

        <knx-form-group
          knxQaIdentifier [qaRoot]="qaRootId" qaIdentifier="houseHold"
          [formControlName]="form.formConfig.houseHold.formControlName"
          [options]="form.formConfig.houseHold">
        </knx-form-group>
      </knx-card>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-12">
      <div class="car-form__coverages">
        <h2>Welke dekking past het beste bij jou</h2>
1
        <knx-price-table
          knxQaIdentifier [qaRoot]="qaRootId" qaIdentifier="coverage"
          [items]="coverages"
          [highlight]="(coverageRecommendation$ | async)?.recommended_value"
          [labels]="{ selected: 'Toon advies', unselected: 'Kies deze' }"
          (onSubmit)="goToNextStep()"
          (onSelected)="updateSelectedCoverage($event)">
        </knx-price-table>

        <div class="knx-message knx-message--error" *ngIf="isCoverageError$ | async">
          Er is een fout opgetreden bij het ophalen van het dekkingsadvies.
        </div>

        <knx-loader [visible]="isCoverageLoading$ | async">
          Een momentje! We vergelijken 19 verschillende aanbieders voor je om de beste match te vinden.
        </knx-loader>
      </div>
    </div>
  </div>
</form>

<knx-wizard-controls [currentStepOptions]="currentStepOptions"
                     [error]="error$ | async"
                     (onNext)="goToNextStep()">
</knx-wizard-controls>
